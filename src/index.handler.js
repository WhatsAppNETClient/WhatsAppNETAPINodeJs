require("dotenv").config();const path=require("path"),fs=require("fs"),mime=require("mime-types"),{vcardToJSON:vcardToJSON,waitFor:waitFor,asyncForEach:asyncForEach,saveMedia:saveMedia}=require("./utils"),{MessageTypes:MessageTypes,Location:Location,List:List,Buttons:Buttons}=require("whatsapp-web.js"),{SESSION_ID:SESSION_ID,IMAGE_AND_DOCUMENT_PATH:IMAGE_AND_DOCUMENT_PATH}=process.env,getContact=async(e,s)=>{let t=void 0;try{t=await s.getContactById(e)}catch(e){console.log(`ex: ${e}`)}return t},connectedHandler=()=>{const{client:e}=require("./wa.utils"),{signalRClient:s,serverHub:t}=require("./signalr.util");console.log("SignalR client connected."),s.connection.hub.invoke(t,"Startup",JSON.stringify({message:"- Initialize...",sessionId:SESSION_ID}));(async()=>{try{console.log("Initialize..."),await e.initialize()}catch(e){console.error("initialize error ...."),s.connection.hub.invoke(t,"Startup",JSON.stringify({message:new String(e),sessionId:SESSION_ID}))}})(),e.on("message_ack",(e,a)=>{if("status@broadcast"===e.from||"status@broadcast"===e.to)return void console.log("update status di skip aja");if(!e.body&&!e.hasMedia)return void console.log("pesan kosong");const n={id:e.id.id,sessionId:SESSION_ID,ack:e.ack?e.ack:-1,content:e.body?e.body:"",type:e.type?e.type:"",from:e.from?e.from:"",to:e.to?e.to:"",unixTimestamp:e.timestamp?e.timestamp:0};n.type!==MessageTypes.CONTACT_CARD&&n.type!==MessageTypes.CONTACT_CARD_MULTI&&n.type!==MessageTypes.LOCATION||(n.content=""),s.connection.hub.invoke(t,"MessageAck",JSON.stringify({message:JSON.stringify(n),sessionId:SESSION_ID}))}),e.on("group_join",async a=>{const n=await getContact(a.chatId,e),i={id:n.id._serialized?n.id._serialized:"",name:n.name?n.name:"",recipients:void 0};let o=[];for(const s of a.recipientIds){const t=await getContact(s,e);let a={};a=t?{id:t.id._serialized?t.id._serialized:"",name:t.name?t.name:"",shortName:t.shortName?t.shortName:"",pushname:t.pushname?t.pushname:""}:{id:s,name:"",shortName:"",pushname:""},o.push(a)}i.recipients=o,s.connection.hub.invoke(t,"GroupJoin",JSON.stringify({groupNotification:i,sessionId:SESSION_ID}))}),e.on("group_leave",async a=>{const n=await getContact(a.chatId,e),i={id:n.id._serialized?n.id._serialized:"",name:n.name?n.name:"",recipients:void 0};let o=[];for(const s of a.recipientIds){const t=await getContact(s,e);let a={};a=t?{id:t.id._serialized?t.id._serialized:"",name:t.name?t.name:"",shortName:t.shortName?t.shortName:"",pushname:t.pushname?t.pushname:""}:{id:s,name:"",shortName:"",pushname:""},o.push(a)}i.recipients=o,s.connection.hub.invoke(t,"GroupLeave",JSON.stringify({groupNotification:i,sessionId:SESSION_ID}))}),e.on("message_create",async e=>{if(e.fromMe){const a="true",n=e.to,i="chat"===e.type?e.body:"",o=e.id.id;s.connection.hub.invoke(t,"SendMessageStatus",JSON.stringify({messageStatus:{status:a,send_to:n,message:i,messageId:o},sessionId:SESSION_ID}))}}),e.on("message",async a=>{if("status@broadcast"===a.from)return void console.log("update status di skip aja");if(!a.body&&!a.hasMedia)return void console.log("pesan kosong");try{(await a.getChat()).sendSeen()}catch(e){console.log(`ex: ${e}`)}let n={},i="";const o=a.hasMedia&&IMAGE_AND_DOCUMENT_PATH;if(o)try{i=(n=await a.downloadMedia()).mimetype}catch(e){console.log(`ex: ${e}`)}const r=a.from.endsWith("@g.us"),d=await getContact(a.from,e);let c=void 0;r&&(c=await getContact(a.author,e));const l={id:a.id._serialized,sessionId:SESSION_ID,content:a.body?a.body:"",type:a.type?a.type:"",from:a.from?a.from:"",to:a.to?a.to:"",sender:r?void 0:{id:d.id._serialized?d.id._serialized:"",name:d.name?d.name:"",shortName:d.shortName?d.shortName:"",pushname:d.pushname?d.pushname:""},group:r?{id:d.id._serialized?d.id._serialized:"",name:d.name?d.name:"",sender:{id:c.id._serialized?c.id._serialized:"",name:c.name?c.name:"",shortName:c.shortName?c.shortName:"",pushname:c.pushname?c.pushname:""}}:void 0,unixTimestamp:a.timestamp?a.timestamp:0,filename:o?`${a.timestamp}.${mime.extension(i)}`:"",location:a.type===MessageTypes.LOCATION?a.location:void 0,vcards:a.type===MessageTypes.CONTACT_CARD||a.type===MessageTypes.CONTACT_CARD_MULTI?[]:void 0,vcardFilenames:a.type===MessageTypes.CONTACT_CARD||a.type===MessageTypes.CONTACT_CARD_MULTI?[]:void 0,selectedButtonId:a.type===MessageTypes.BUTTONS_RESPONSE?a.selectedButtonId:void 0,selectedRowId:a.type===MessageTypes.LIST_RESPONSE?a.selectedRowId:void 0};if(l.type!==MessageTypes.CONTACT_CARD&&l.type!==MessageTypes.CONTACT_CARD_MULTI&&l.type!==MessageTypes.LOCATION||(l.content=""),l.type===MessageTypes.CONTACT_CARD&&(l.vcards.push(vcardToJSON(a.body)),IMAGE_AND_DOCUMENT_PATH)){const{fn:e}=l.vcards[0],s=`${l.unixTimestamp}_${e}.vcf`;l.vcardFilenames.push(s)}if(l.type===MessageTypes.CONTACT_CARD_MULTI){let e=0;for(const s of a.vCards){if(l.vcards.push(vcardToJSON(s)),IMAGE_AND_DOCUMENT_PATH){const{fn:s}=l.vcards[e],t=`${l.unixTimestamp}_${s}.vcf`;l.vcardFilenames.push(t)}e++}}if(s.connection.hub.invoke(t,"ReceiveMessage",JSON.stringify({message:l,sessionId:SESSION_ID})),o){const{data:e}=n,s=new Buffer.from(e,"base64");saveMedia(IMAGE_AND_DOCUMENT_PATH,l.filename,s)}if(a.type===MessageTypes.CONTACT_CARD&&IMAGE_AND_DOCUMENT_PATH){const e=l.vcardFilenames[0];saveMedia(IMAGE_AND_DOCUMENT_PATH,e,a.body)}if(l.type===MessageTypes.CONTACT_CARD_MULTI&&IMAGE_AND_DOCUMENT_PATH){let e=0;for(const s of a.vCards){const t=l.vcardFilenames[e];saveMedia(IMAGE_AND_DOCUMENT_PATH,t,s),e++}}})},onSetStatusHandler=async e=>{const{client:s,sendTextAsync:t,sendImageOrFileAsync:a,sendImageOrFileFromUrlAsync:n}=require("./wa.utils"),i=JSON.parse(e),{sessionId:o,send_to:r,message:d,type:c,attachmentOrUrl:l}=i;o===SESSION_ID?"image"===c?await a(r,l,d,null,s):"url"===c?await n(r,l,d,null,s):await t(r,d,null,s):console.log("beda sessi enggak usah diproses")},isUrl=e=>/^(?:\w+:)?\/\/([^\s\.]+\.\S{2}|localhost[\:?\d]*)\S*$/.test(e),onSendMessageHandler=async e=>{const{client:s,sendTextAsync:t,sendListOrButtonAsync:a,sendImageOrFileAsync:n,sendImageOrFileFromUrlAsync:i,replyAsync:o}=require("./wa.utils"),{signalRClient:r,serverHub:d}=require("./signalr.util"),c=JSON.parse(e),{sessionId:l,send_to:u,message:g,type:S,attachmentOrUrl:m,quotedMessageId:p,mentions:I}=c;if(l===SESSION_ID)if("image"===S||"file"===S){const e=(await n(u,m,g,I,s)).toString().split("_"),[t,a,i,o]=e;"false"===t&&r.connection.hub.invoke(d,"SendMessageStatus",JSON.stringify({messageStatus:{status:t,send_to:a,message:i,messageId:o},sessionId:SESSION_ID}))}else if("url"===S){const e=(await i(u,m,g,I,s)).toString().split("_"),[t,a,n,o]=e;"false"===t&&r.connection.hub.invoke(d,"SendMessageStatus",JSON.stringify({messageStatus:{status:t,send_to:a,message:n,messageId:o},sessionId:SESSION_ID}))}else if("location"===S){const e=JSON.parse(g),a=new Location(e.latitude,e.longitude,e.description);let n="";const i=(n=p?await o(u,a,p,s):await t(u,a,I,s)).toString().split("_"),[c,l,S,m]=i;"false"===c&&r.connection.hub.invoke(d,"SendMessageStatus",JSON.stringify({messageStatus:{status:c,send_to:l,message:S,messageId:m},sessionId:SESSION_ID}))}else if("list"===S){const e=JSON.parse(g),t=new List(e.content,e.listText,e.sections,e.title),n=(await a(u,t,S,null,I,s)).toString().split("_"),[i,o,c,l]=n;"false"===i&&r.connection.hub.invoke(d,"SendMessageStatus",JSON.stringify({messageStatus:{status:i,send_to:o,message:c,messageId:l},sessionId:SESSION_ID}))}else if("button"===S){const e=JSON.parse(g);let t=void 0;if(m){const{MessageMedia:n}=require("whatsapp-web.js");let i=void 0;i=isUrl(m)?await n.fromUrl(m):n.fromFilePath(m);const o=new Buttons(i,e.items);t=await a(u,o,S,e.content,I,s)}else{const n=new Buttons(e.content,e.items,e.title);t=await a(u,n,S,null,I,s)}const n=t.toString().split("_"),[i,o,c,l]=n;"false"===i&&r.connection.hub.invoke(d,"SendMessageStatus",JSON.stringify({messageStatus:{status:i,send_to:o,message:c,messageId:l},sessionId:SESSION_ID}))}else{let e="";const a=(e=p?await o(u,g,p,s):await t(u,g,I,s)).toString().split("_"),[n,i,c,l]=a;"false"===n&&r.connection.hub.invoke(d,"SendMessageStatus",JSON.stringify({messageStatus:{status:n,send_to:i,message:c,messageId:l},sessionId:SESSION_ID}))}else console.log("beda sessi enggak usah diproses")},onBroadcastMessageHandler=async(e,s)=>{const{client:t,sendTextAsync:a,sendImageOrFileAsync:n,sendImageOrFileFromUrlAsync:i}=require("./wa.utils"),{signalRClient:o,serverHub:r}=require("./signalr.util"),d=JSON.parse(e);await asyncForEach(d,async e=>{const{sessionId:d,send_to:c,message:l,type:u,attachmentOrUrl:g,mentions:S}=e;if(d===SESSION_ID){if("image"===u||"file"===u){const e=(await n(c,g,l,S,t)).toString().split("_"),[s,a,i]=e;"false"===s&&o.connection.hub.invoke(r,"SendMessageStatus",JSON.stringify({messageStatus:{status:s,send_to:a,message:i},sessionId:SESSION_ID}))}else if("url"===u){const e=(await i(c,g,l,S,t)).toString().split("_"),[s,a,n]=e;"false"===s&&o.connection.hub.invoke(r,"SendMessageStatus",JSON.stringify({messageStatus:{status:s,send_to:a,message:n},sessionId:SESSION_ID}))}else if("location"===u){const e=JSON.parse(l),s=new Location(e.latitude,e.longitude,e.description),n=(await a(c,s,S,t)).toString().split("_"),[i,d,u]=n;"false"===i&&o.connection.hub.invoke(r,"SendMessageStatus",JSON.stringify({messageStatus:{status:i,send_to:d,message:u},sessionId:SESSION_ID}))}else{const e=(await a(c,l,S,t)).toString().split("_"),[s,n,i]=e;"false"===s&&o.connection.hub.invoke(r,"SendMessageStatus",JSON.stringify({messageStatus:{status:s,send_to:n,message:i},sessionId:SESSION_ID}))}await waitFor(s)}})},onVerifyWANumberHandler=async(e,s)=>{const{client:t}=require("./wa.utils"),{signalRClient:a,serverHub:n}=require("./signalr.util"),i=JSON.parse(e);let o=[];await asyncForEach(i,async e=>{const{phoneNumber:i,sessionId:r}=e;if(r===SESSION_ID){if(await t.isRegisteredUser(i))if(s){const e=await getContact(i,t);if(e){const s={id:e.id._serialized?e.id._serialized:"",name:e.name?e.name:"",shortName:e.shortName?e.shortName:"",pushname:e.pushname?e.pushname:"",verifiedName:e.verifiedName?e.verifiedName:"",sessionId:SESSION_ID};o.push(s),100===o.length&&(a.connection.hub.invoke(n,"ReceiveContacts",JSON.stringify({contacts:o,sessionId:SESSION_ID})),o=[])}}else{const e={id:i,name:"Verified",sessionId:SESSION_ID};o.push(e),100===o.length&&(a.connection.hub.invoke(n,"ReceiveContacts",JSON.stringify({contacts:o,sessionId:SESSION_ID})),o=[])}else{const e={id:i,name:"Not verified",sessionId:SESSION_ID};o.push(e),100===o.length&&(a.connection.hub.invoke(n,"ReceiveContacts",JSON.stringify({contacts:o,sessionId:SESSION_ID})),o=[])}}}),o.push({id:"status@broadcast"}),a.connection.hub.invoke(n,"ReceiveContacts",JSON.stringify({contacts:o,sessionId:SESSION_ID}))},onGrabContactHandler=async e=>{const{client:s}=require("./wa.utils"),{signalRClient:t,serverHub:a}=require("./signalr.util"),n=JSON.parse(e),{sessionId:i}=n;if(i!==SESSION_ID)return void console.log("beda sessi enggak usah diproses");let o=[];try{o=await s.getContacts()}catch(e){console.log(`ex: ${e}`)}let r=[];o.forEach(e=>{if(!e.isMe){const s=e.id._serialized.toString().split("@");if(s[0].length>5&&"c.us"===s[1]){const s={id:e.id._serialized?e.id._serialized:"",name:e.name?e.name:"",shortName:e.shortName?e.shortName:"",pushname:e.pushname?e.pushname:"",verifiedName:e.verifiedName?e.verifiedName:"",sessionId:SESSION_ID};"status@broadcast"!==s.id&&r.push(s),100===r.length&&(t.connection.hub.invoke(a,"ReceiveContacts",JSON.stringify({contacts:r,sessionId:SESSION_ID})),r=[])}}}),r.push({id:"status@broadcast"}),t.connection.hub.invoke(a,"ReceiveContacts",JSON.stringify({contacts:r,sessionId:SESSION_ID}))},onGrabGroupHandler=async e=>{const{client:s}=require("./wa.utils"),{signalRClient:t,serverHub:a}=require("./signalr.util"),n=JSON.parse(e),{sessionId:i}=n;if(i!==SESSION_ID)return void console.log("beda sessi enggak usah diproses");let o=[];try{o=await s.getChats()}catch(e){console.log(`ex: ${e}`)}let r=[];o.forEach(e=>{if(e.isGroup){const s={id:e.id._serialized?e.id._serialized:"",name:e.name?e.name:"",sessionId:SESSION_ID};r.push(s)}}),r.push({id:"status@broadcast"}),t.connection.hub.invoke(a,"ReceiveGroups",JSON.stringify({groups:r,sessionId:SESSION_ID}))},onGrabGroupAndMemberHandler=async e=>{const{client:s}=require("./wa.utils"),{signalRClient:t,serverHub:a}=require("./signalr.util"),n=JSON.parse(e),{sessionId:i}=n;if(i!==SESSION_ID)return void console.log("beda sessi enggak usah diproses");let o=[];try{o=await s.getChats()}catch(e){console.log(`ex: ${e}`)}let r=[];o.forEach(e=>{if(e.isGroup){let s=[];e.groupMetadata.participants.forEach(e=>{const t={id:e.id._serialized?e.id._serialized:"",name:"",shortName:"",pushname:""};s.push(t)});const t={id:e.id._serialized?e.id._serialized:"",name:e.name?e.name:"",sessionId:SESSION_ID,members:s};r.push(t)}});let d=[];for(const e of r){for(const t of e.members)try{const e=await getContact(t.id,s);t.name=e.name?e.name:"",t.shortName=e.shortName?e.shortName:"",t.pushname=e.pushname?e.pushname:""}catch(e){console.log("onGrabGroupAndMemberHandler error ...."),console.log(`ex: ${e}`)}d.push(e),1===d.length&&(t.connection.hub.invoke(a,"ReceiveGroups",JSON.stringify({groups:d,sessionId:SESSION_ID})),d=[])}d.push({id:"status@broadcast"}),t.connection.hub.invoke(a,"ReceiveGroups",JSON.stringify({groups:d,sessionId:SESSION_ID}))},onArchiveChatHandler=async e=>{const{client:s}=require("./wa.utils"),t=JSON.parse(e),{sessionId:a,phoneNumber:n}=t;if(a===SESSION_ID)if(n){(await s.getChatById(n)).archive()}else{const e=await s.getChats();for(const s of e)await s.archive()}else console.log("beda sessi enggak usah diproses")},onDeleteChatHandler=async e=>{const{client:s}=require("./wa.utils"),t=JSON.parse(e),{sessionId:a,phoneNumber:n}=t;if(a===SESSION_ID)if(n){(await s.getChatById(n)).delete()}else{const e=await s.getChats();for(const s of e)await s.delete()}else console.log("beda sessi enggak usah diproses")},onGetBatteryStatusHandler=async e=>{const{client:s}=require("./wa.utils"),{signalRClient:t,serverHub:a}=require("./signalr.util"),n=JSON.parse(e),{sessionId:i}=n;if(i!==SESSION_ID)return void console.log("beda sessi enggak usah diproses");const o=await s.info.getBatteryStatus(),{battery:r,plugged:d}=o;console.log(`Battery: ${r}% - Charging? ${d}`),t.connection.hub.invoke(a,"ChangeBattery",JSON.stringify({battery:r,plugged:d,sessionId:SESSION_ID}))},onDisconnectHandler=async e=>{const{signalRClient:s}=require("./signalr.util"),{client:t}=require("./wa.utils"),a=JSON.parse(e),{sessionId:n}=a;if(n===SESSION_ID){try{await t.destroy()}catch(e){console.log(`ex: ${e}`)}setTimeout(()=>process.exit(),500),s.end()}else console.log("beda sessi enggak usah diproses")},onLogoutHandler=async e=>{const{signalRClient:s}=require("./signalr.util"),{client:t}=require("./wa.utils"),a=JSON.parse(e),{sessionId:n}=a;if(n===SESSION_ID){try{await t.logout();const e=path.join(path.resolve("./session"),`${SESSION_ID}.json`);fs.rm(e,{force:!0},s=>{s&&console.log(s),console.log(`${e} is deleted!`)})}catch(e){console.log(`ex: ${e}`)}setTimeout(()=>process.exit(),500),s.end()}else console.log("beda sessi enggak usah diproses")},onGetAllMessageHandler=async e=>{const{client:s}=require("./wa.utils"),{signalRClient:t,serverHub:a}=require("./signalr.util"),n=JSON.parse(e),{sessionId:i,phoneNumber:o,limit:r}=n;if(i!==SESSION_ID)return void console.log("beda sessi enggak usah diproses");let d=[];if(o){const e=await s.getChatById(o);if(!e)return void console.log("belum ada chat, enggak usah diproses");const n=await e.fetchMessages({limit:r});for(const e of n){if(!e.body){console.log("pesan kosong");continue}const n=e.from.endsWith("@g.us"),i=await getContact(e.from,s);let o=void 0;n&&(o=await getContact(e.author,s));const r={id:e.id._serialized,sessionId:SESSION_ID,content:e.body?e.body:"",type:e.type?e.type:"",from:e.from?e.from:"",to:e.to?e.to:"",sender:n?void 0:{id:i.id._serialized?i.id._serialized:"",name:i.name?i.name:"",shortName:i.shortName?i.shortName:"",pushname:i.pushname?i.pushname:""},group:n?{id:i.id._serialized?i.id._serialized:"",name:i.name?i.name:"",sender:{id:o.id._serialized?o.id._serialized:"",name:o.name?o.name:"",shortName:o.shortName?o.shortName:"",pushname:o.pushname?o.pushname:""}}:void 0,unixTimestamp:e.timestamp?e.timestamp:0,filename:"",location:e.type===MessageTypes.LOCATION?e.location:void 0,vcards:e.type===MessageTypes.CONTACT_CARD||e.type===MessageTypes.CONTACT_CARD_MULTI?[]:void 0,selectedButtonId:e.type===MessageTypes.BUTTONS_RESPONSE?e.selectedButtonId:void 0,selectedRowId:e.type===MessageTypes.LIST_RESPONSE?e.selectedRowId:void 0};if(r.type!==MessageTypes.CONTACT_CARD&&r.type!==MessageTypes.CONTACT_CARD_MULTI&&r.type!==MessageTypes.LOCATION||(r.content=""),r.type===MessageTypes.CONTACT_CARD&&r.vcards.push(vcardToJSON(e.body)),r.type===MessageTypes.CONTACT_CARD_MULTI)for(const s of e.vCards)r.vcards.push(vcardToJSON(s));d.push(r),50===d.length&&(t.connection.hub.invoke(a,"ReceiveMessages",JSON.stringify({messages:d,sessionId:SESSION_ID})),d=[])}d.push({id:"status@broadcast",type:"text",content:"",sessionId:SESSION_ID}),d.length>0&&(t.connection.hub.invoke(a,"ReceiveMessages",JSON.stringify({messages:d,sessionId:SESSION_ID})),d=[])}},onGetUnreadMessageHandler=async e=>{const{client:s}=require("./wa.utils"),{signalRClient:t,serverHub:a}=require("./signalr.util"),n=JSON.parse(e),{sessionId:i}=n;if(i!==SESSION_ID)return void console.log("beda sessi enggak usah diproses");let o=[];try{o=await s.getChats()}catch(e){console.log(`ex: ${e}`)}let r=[];for(const e of o)if(e.sendSeen(),e.unreadCount>0){const n=await e.fetchMessages({limit:e.unreadCount});for(const e of n){if(!e.body){console.log("pesan kosong");continue}const n=e.from.endsWith("@g.us"),i=await getContact(e.from,s);let o=void 0;n&&(o=await getContact(e.author,s));const d={id:e.id._serialized,sessionId:SESSION_ID,content:e.body?e.body:"",type:e.type?e.type:"",from:e.from?e.from:"",to:e.to?e.to:"",sender:n?void 0:{id:i.id._serialized?i.id._serialized:"",name:i.name?i.name:"",shortName:i.shortName?i.shortName:"",pushname:i.pushname?i.pushname:""},group:n?{id:i.id._serialized?i.id._serialized:"",name:i.name?i.name:"",sender:{id:o.id._serialized?o.id._serialized:"",name:o.name?o.name:"",shortName:o.shortName?o.shortName:"",pushname:o.pushname?o.pushname:""}}:void 0,unixTimestamp:e.timestamp?e.timestamp:0,filename:"",location:e.type===MessageTypes.LOCATION?e.location:void 0,vcards:e.type===MessageTypes.CONTACT_CARD||e.type===MessageTypes.CONTACT_CARD_MULTI?[]:void 0,selectedButtonId:e.type===MessageTypes.BUTTONS_RESPONSE?e.selectedButtonId:void 0,selectedRowId:e.type===MessageTypes.LIST_RESPONSE?e.selectedRowId:void 0};if(d.type!==MessageTypes.CONTACT_CARD&&d.type!==MessageTypes.CONTACT_CARD_MULTI&&d.type!==MessageTypes.LOCATION||(d.content=""),d.type===MessageTypes.CONTACT_CARD&&d.vcards.push(vcardToJSON(e.body)),d.type===MessageTypes.CONTACT_CARD_MULTI)for(const s of e.vCards)d.vcards.push(vcardToJSON(s));r.push(d),100===r.length&&(t.connection.hub.invoke(a,"ReceiveMessages",JSON.stringify({messages:r,sessionId:SESSION_ID})),r=[])}}r.push({id:"status@broadcast",type:"text",content:"",sessionId:SESSION_ID}),r.length>0&&(t.connection.hub.invoke(a,"ReceiveMessages",JSON.stringify({messages:r,sessionId:SESSION_ID})),r=[])};module.exports={connectedHandler:connectedHandler,onSetStatusHandler:onSetStatusHandler,onSendMessageHandler:onSendMessageHandler,onBroadcastMessageHandler:onBroadcastMessageHandler,onVerifyWANumberHandler:onVerifyWANumberHandler,onGrabContactHandler:onGrabContactHandler,onGrabGroupHandler:onGrabGroupHandler,onGrabGroupAndMemberHandler:onGrabGroupAndMemberHandler,onArchiveChatHandler:onArchiveChatHandler,onDeleteChatHandler:onDeleteChatHandler,onGetUnreadMessageHandler:onGetUnreadMessageHandler,onGetAllMessageHandler:onGetAllMessageHandler,onDisconnectHandler:onDisconnectHandler,onLogoutHandler:onLogoutHandler,onGetBatteryStatusHandler:onGetBatteryStatusHandler};