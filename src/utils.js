const fs=require("fs"),mime=require("mime"),fetch=require("node-fetch"),{URL:URL}=require("url"),{MessageMedia:MessageMedia}=require("whatsapp-web.js"),vcardToJSON=e=>{const r={},o=e.split("\n");for(const e of o){const[o,a]=e.split(":");"BEGIN"!==o&&"END"!==o&&"PHOTO;BASE64"!==o&&("VERSION"===o&&(r.version=a),"N"===o&&(r.n=a),"FN"===o&&(r.fn=a),"ORG"===o&&(r.org=a),"TITLE"===o&&(r.title=a),o.toLowerCase().indexOf("waid")>=0&&(r.waid=a),"TEL;type=Work"===o&&(r.telWork=a),"TEL;type=Home"===o&&(r.telHome=a),"EMAIL;TYPE=Work"===o&&(r.emailWork=a),"EMAIL;TYPE=Home"===o&&(r.emailHome=a),o.indexOf("ADR;type=Work")>=0&&(r.adrWork=a),o.indexOf("ADR;type=Home")>=0&&(r.adrHome=a))}return r},waitFor=e=>new Promise(r=>setTimeout(r,e)),asyncForEach=async(e,r)=>{for(let o=0;o<e.length;o++)await r(e[o],o,e)},saveMedia=(e,r,o)=>{fs.writeFile(`${e}\\${r}`,o,e=>{e&&console.log(e),console.log(`The file '${r}' was saved!`)})},fromUrl=(e,r=0)=>new Promise((o,a)=>{const t=new URL(e),i=mime.getType(t.pathname);if(!i)return a(new Error("Unable to determine MIME type"));fetch(e,{size:r,headers:{accept:"image/* video/* text/* audio/*"}}).then(async e=>{if(!e.ok)return a(new Error("Failed to download media"));const r=(await e.buffer()).toString("base64"),t=new MessageMedia(i,r,null);return o(t)}).catch(e=>a(e))});module.exports={vcardToJSON:vcardToJSON,waitFor:waitFor,asyncForEach:asyncForEach,saveMedia:saveMedia,fromUrl:fromUrl};